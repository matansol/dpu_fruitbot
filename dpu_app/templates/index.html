<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruitbot RL Feedback Interface</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üçé Fruitbot RL Agent Feedback Interface</h1>
            <p class="subtitle">Help improve AI agents by providing feedback on their actions</p>
        </header>

        <main>
            <!-- Game Display Section -->
            <section class="game-section">
                <div class="game-container">
                    <img id="game-image" src="" alt="Game State" class="game-image">
                    <div class="game-overlay" id="game-overlay">
                        <div class="overlay-content">
                            <h2>Welcome!</h2>
                            <p>Click "Start Game" to begin</p>
                        </div>
                    </div>
                </div>

                <!-- Game Stats -->
                <div class="stats-panel">
                    <div class="stat-item">
                        <span class="stat-label">Episode:</span>
                        <span id="episode-display" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Score:</span>
                        <span id="score-display" class="stat-value">0.0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Step:</span>
                        <span id="step-display" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Reward:</span>
                        <span id="reward-display" class="stat-value">0.0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Last Action:</span>
                        <span id="action-display" class="stat-value">None</span>
                    </div>
                </div>
            </section>

            <!-- Controls Section -->
            <section class="controls-section">
                <div class="control-group">
                    <h3>Game Controls</h3>
                    <button id="btn-start" class="btn btn-primary">Start Game</button>
                    <button id="btn-agent-action" class="btn btn-secondary">Agent Action</button>
                    <button id="btn-play-episode" class="btn btn-secondary">Play Full Episode</button>
                    <button id="btn-next-episode" class="btn btn-info" style="display: none;">Next Episode</button>
                </div>

                <div class="control-group">
                    <h3>Movement Controls</h3>
                    <div class="movement-grid">
                        <!-- Top row: Q, W, E (diagonal up-left, up, diagonal up-right) -->
                        <button id="btn-upleft" class="btn btn-action">‚Üñ Q</button>
                        <button id="btn-up" class="btn btn-action">‚Üë W</button>
                        <button id="btn-upright" class="btn btn-action">‚Üó E</button>
                        
                        <!-- Middle row: A, NOOP, D (left, noop, right) -->
                        <button id="btn-left" class="btn btn-action">‚Üê A</button>
                        <button id="btn-noop" class="btn btn-action">‚äó Space</button>
                        <button id="btn-right" class="btn btn-action">‚Üí D</button>
                        
                        <!-- Bottom row: Z, X, C (diagonal down-left, down, diagonal down-right) -->
                        <button id="btn-downleft" class="btn btn-action">‚Üô Z</button>
                        <button id="btn-down" class="btn btn-action">‚Üì S/X</button>
                        <button id="btn-downright" class="btn btn-action">‚Üò C</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>Instructions</h3>
                    <div id="instructions" class="instructions-box">
                        <p><strong>Keyboard Controls:</strong></p>
                        <ul>
                            <li><strong>Arrow Keys / WASD:</strong> Move in cardinal directions</li>
                            <li><strong>Q/E/Z/C:</strong> Diagonal movements</li>
                            <li><strong>Space:</strong> No action (NOOP)</li>
                        </ul>
                        <p><strong>Feedback Mode:</strong> Watch the agent play, then provide feedback on actions you'd change</p>
                    </div>
                </div>
            </section>

            <!-- Feedback Section -->
            <section class="feedback-section" id="feedback-section" style="display: none;">
                <h3>Provide Feedback</h3>
                <div id="feedback-container">
                    <!-- Feedback UI will be dynamically generated here -->
                </div>
                <div class="feedback-controls">
                    <button id="btn-submit-feedback" class="btn btn-primary">Submit Feedback</button>
                    <button id="btn-no-feedback" class="btn btn-secondary">No Feedback</button>
                </div>
            </section>

            <!-- Agent Comparison Section -->
            <section class="comparison-section" id="comparison-section" style="display: none;">
                <h3>Agent Comparison</h3>
                <div class="comparison-container">
                    <div class="agent-display">
                        <h4>Previous Agent</h4>
                        <div id="prev-agent-path"></div>
                        <div id="prev-agent-score"></div>
                    </div>
                    <div class="agent-display">
                        <h4>Updated Agent</h4>
                        <div id="new-agent-path"></div>
                        <div id="new-agent-score"></div>
                    </div>
                </div>
                <div class="comparison-controls">
                    <button id="btn-keep-new" class="btn btn-success">Keep Updated Agent</button>
                    <button id="btn-keep-old" class="btn btn-warning">Revert to Previous</button>
                </div>
            </section>
        </main>

        <footer>
            <p>Fruitbot RL Feedback System | Procgen Environment</p>
        </footer>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>
